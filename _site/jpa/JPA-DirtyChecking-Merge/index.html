<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.23.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>변경 감지와 병합 - yessm621.dev</title>
<meta name="description" content="✨ 결론부터 말하면 병합(merge)은 사용하지 말고 변경 감지(Dirth Checking)를 사용하자.">


  <meta name="author" content="승미">
  
  <meta property="article:author" content="승미">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="yessm621.dev">
<meta property="og:title" content="변경 감지와 병합">
<meta property="og:url" content="http://localhost:4000/jpa/JPA-DirtyChecking-Merge/">


  <meta property="og:description" content="✨ 결론부터 말하면 병합(merge)은 사용하지 말고 변경 감지(Dirth Checking)를 사용하자.">







  <meta property="article:published_time" content="2023-01-26T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/jpa/JPA-DirtyChecking-Merge/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "승미",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="yessm621.dev Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- 사이트 맨위에 책 모양으로  파비콘 등록-->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icon/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->
    <!--폰트 : "Nanum Gothic Coding", "Coming Soon"-->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Coming+Soon&family=Nanum+Gothic+Coding&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Coming+Soon&family=Nanum+Gothic+Coding&display=swap">
     
    <!--폰트 : "Iropke Batang"-->
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/font-iropke-batang/1.2/font-iropke-batang.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/font-iropke-batang/1.2/font-iropke-batang.css">
  </head>

  <body class="layout--single <!-- 본문 늘리기!!!-->">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/setting/logo.png" alt="yessm621.dev"></a>
        
        <a class="site-title" href="/">
          yessm621.dev
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Category</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tag</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/setting/bio-photo.png" alt="승미" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">승미</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>공부하며 기록하는 블로그입니다.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">South Korea</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/yessm621" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="mailto:yessm621@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  

  <!--전체 글 수를 세기 위한 연산. sum 변수에 전체 글 수 저장-->



<nav class="nav__list">
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">메뉴</label>
  <ul class="nav__items" id="category_tag_menu">
      
      <!--전체 글 수-->
      <li>
            📂 <span style="font-family:'Cafe24Oneprettynight';">전체 글 수</style> <span style="font-family:'Coming Soon';">80</style> <span style="font-family:'Cafe24Oneprettynight';">개</style> 
      </li>

      <li>
        <!--기본 양식
         <span class="nav__sub-title">옆에 들어갈 큰 제목</span>
            <ul> 
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        -->
    
        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">Java</span><!--큰 카테고리-->
            <!--ul 태그로 같은 카테고리들 모아둔 페이지들 나열-->

            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Java" class="">문법(8)</a></li>
                    
                
                    
                
                    
                
            </ul>

            <ul>
                
                    
                        <li><a href="/categories/SpringBoot" class="">SpringBoot(31)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>

            <ul>
                
                    
                
                    
                        <li><a href="/categories/Jpa" class="">JPA(23)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>

            <ul>
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/TestCode" class="">테스트코드(3)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        <!--------------------------------------분류 끝-------------------------------------------->
        
        <!--------------------------------------분류 시작-------------------------------------------->
        <!-- <span class="nav__sub-title">Python</span>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>     -->
        <!--------------------------------------분류 끝-------------------------------------------->

        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">Series</span>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Series" class="">시리즈(4)</a></li>
                    
                
            </ul>    
        <!--------------------------------------분류 끝-------------------------------------------->

        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">Git</span>
            <ul>
                
                    
                
                    
                
                    
                        <li><a href="/categories/Git" class="">Git(1)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>    
        <!--------------------------------------분류 끝-------------------------------------------->
        
        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">CS</span>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Http" class="">Http(7)</a></li>
                    
                
                    
                
            </ul>

            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Auth" class="">인증/인가(3)</a></li>
                    
                
                    
                
                    
                
                    
                
            </ul>

        <!--------------------------------------분류 끝-------------------------------------------->


      </li>
 
  </ul>
</nav>

  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="변경 감지와 병합">
    <meta itemprop="description" content="✨ 결론부터 말하면 병합(merge)은 사용하지 말고 변경 감지(Dirth Checking)를 사용하자.">
    <meta itemprop="datePublished" content="2023-01-26T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">변경 감지와 병합
</h1>
          

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 작성일</strong> <time datetime="2023-01-26T00:00:00+09:00">January 26, 2023</time></p>

<!--작성일-->
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu"><li><a href="#준영속-엔티티">준영속 엔티티</a><ul><li><a href="#준영속-엔티티를-수정하는-방법">준영속 엔티티를 수정하는 방법</a></li></ul></li><li><a href="#변경-감지와-병합merge">변경 감지와 병합(merge)</a><ul><li><a href="#변경-감지-기능-사용">변경 감지 기능 사용</a></li><li><a href="#병합merge">병합(merge)</a></li><li><a href="#왜-변경-감지를-사용해야-할까">왜 변경 감지를 사용해야 할까?</a></li></ul></li><li><a href="#정리">정리</a></li></ul>

            </nav>
          </aside>
        
        <aside>
✨ 결론부터 말하면 병합(merge)은 사용하지 말고 변경 감지(Dirth Checking)를 사용하자.

</aside>

<p>변경 감지와 병합에 대해 알아보기 전에 먼저 준영속 엔티티에 대해 알아보자.</p>

<h2 id="준영속-엔티티">준영속 엔티티</h2>

<p><code class="language-plaintext highlighter-rouge">준영속 엔티티</code>란 영속성 컨텍스트가 더는 관리하지 않는 엔티티를 말한다. 영속성 컨텍스트가 관리하는 영속 상태의 엔티티가 영속성 컨텍스트에서 <strong>분리(detached)</strong>된 엔티티이다.</p>

<p>여기서는 itemService.saveItem(book)에서 수정을 시도하는 Book 객체이다. Book 객체는 이미 DB에 한번 저장되어서 식별자가 존재한다. 이렇게 임의로 만들어낸 엔티티도 기존 식별자를 가지고 있으면 준영속 엔티티로 볼 수 있다.</p>

<p>준영속이라는 단어는 객체를 new 했거나, 안했거나를 기준으로 나누는 것이 아니다. <strong>핵심은 식별자를 기준으로 영속상태가 되어서 DB에 저장된 적이 있는가</strong> 를 기준으로 생각해야 한다. 그래서 식별자를 기준으로 이미 한번 영속상태가 되어버린 엔티티가 있는데, 더이상 영속성 컨텍스트가 관리하지 않으면 모두 준영속 상태이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/items/{itemId}/edit"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">updateItem</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">itemId</span><span class="o">,</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"form"</span><span class="o">)</span> <span class="nc">BookForm</span> <span class="n">form</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">();</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="n">book</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="n">form</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
    <span class="o">...</span>

    <span class="n">itemService</span><span class="o">.</span><span class="na">saveItem</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/items"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위의 Book은 새로운 객체이다. 하지만, Book에 들어가는 데이터는 이미 DB에 한번 저장되어서 식별자가 존재한다. 임의로 만들어낸 엔티티도 기존 식별자를 가지고 있으면 <code class="language-plaintext highlighter-rouge">준영속 엔티티</code>로 볼 수 있다.</p>

<p>준영속 엔티티의 문제점은 JPA가 관리를 하지 않기 때문에 변경 감지가 일어나지 않는다. 그렇다면, 준영속 엔티티를 어떻게 수정해야 할까?</p>

<h3 id="준영속-엔티티를-수정하는-방법">준영속 엔티티를 수정하는 방법</h3>

<p>준영속 엔티티를 수정할 수 있는 방법은 <strong>변경 감지(Dirty Checking)</strong> 기능을 사용하거나 <strong>병합(merge)</strong>을 사용하는 것이다.</p>

<blockquote>
  <p><strong>참고</strong>
엔티티는 영속 상태로 관리된다. 영속 상태에 있는 엔티티는 값만 바꿔도 JPA가 트랜잭션 커밋 시점에 변경된 내용을 알아서 변경해준다.</p>

</blockquote>

<h2 id="변경-감지와-병합merge">변경 감지와 병합(merge)</h2>

<h3 id="변경-감지-기능-사용">변경 감지 기능 사용</h3>

<p><code class="language-plaintext highlighter-rouge">변경 감지</code>는 영속성 컨텍스트에서 엔티티를 다시 조회한 후에 데이터를 수정하는 방법이다.</p>

<p><strong>트랜잭션 안</strong>에서 식별자를 통해 엔티티를 다시 조회한 후, 트랜잭션 커밋 시점(flush())에 JPA가 변경된 내용을 찾아서 DB에 UPDATE SQL 실행한다. 이것이 변경 감지(Dirty Checking)이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateItem</span><span class="o">(</span><span class="nc">Long</span> <span class="n">itemId</span><span class="o">,</span> <span class="nc">Book</span> <span class="n">param</span><span class="o">){</span>
    <span class="nc">Item</span> <span class="n">findItem</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">itemId</span><span class="o">);</span>
    <span class="n">findItem</span><span class="o">.</span><span class="na">setPrice</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getPrice</span><span class="o">());</span>
    <span class="n">findItem</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
    <span class="n">findItem</span><span class="o">.</span><span class="na">setStockQuantity</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getStockQuantity</span><span class="o">());</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>트랜잭션 안에서 itemRepository.findOne(itemId)을 조회하므로 영속 상태의 엔티티를 찾아온다.
    <ul>
      <li>트랜잭션 바깥에서 조회하면 영속 상태의 엔티티를 조회하는 것이 아니다.</li>
    </ul>
  </li>
  <li>영속 상태의 데이터를 setter()로 수정한다.</li>
  <li>@Transactional 애노테이션으로 인해 커밋이 되면서 flush()를 날리면, 영속성 컨텍스트가 변경이 일어난 엔티티를 찾아 DB에 update 쿼리를 날려준다.</li>
</ul>

<h3 id="병합merge">병합(merge)</h3>

<p>병합은 준영속 상태의 엔티티를 영속 상태로 변경할 때 사용하는 기능이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">Item</span> <span class="n">itemParam</span><span class="o">)</span> <span class="o">{</span> <span class="c1">//itemParam: 파리미터로 넘어온 준영속 상태의 엔티티</span>
    <span class="nc">Item</span> <span class="n">mergeItem</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">itemParam</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>간단하게 말하면 병합은 변경 감지에서 사용했던 코드를 JPA가 코드 한줄로 처리한 것이다. merge()가 호출되면 파라미터로 넘어온 item의 식별자 값으로 1차 캐시에서 엔티티를 조회한다. 만약, 1차 캐시에 엔티티가 없으면 DB를 조회하고 1차 캐시에 저장한다. 조회한 엔티티는 영속 상태이다. JPA가 파라미터로 넘어온 값(준영속 엔티티)을 영속 상태의 엔티티의 값과 모두 바꿔치기(교체, merge) 한다. (findItem.setPrice(param.getPrice())을 자동으로 해준다.)</p>

<p>결과적으로, 위의 코드에서 파라미터로 넘어온 itemParam은 준영속 상태이고 mergeItem은 영속 상태이다.</p>

<h3 id="왜-변경-감지를-사용해야-할까">왜 변경 감지를 사용해야 할까?</h3>

<p>변경 감지 기능을 사용하면 원하는 속성만 선택해서 변경할 수 있지만, 병합을 사용하면 모든 속성이 변경된다. 병합 시 값이 없으면 null로 업데이트 할 위험이 있다. (병합은 모든 필드를 교체한다.)</p>

<p>실무에서 데이터 수정은 매우 제한적이다. 모든 필드를 변경하는 경우가 거의 없다. 따라서, 실무에선 가급적 병합(merge)을 쓰지 말고 <code class="language-plaintext highlighter-rouge">변경 감지</code>를 사용하자.</p>

<blockquote>
  <p><strong>참고</strong> 영속상태의 엔티티 수정
영속 상태의 엔티티는 변경 감지 기능이 동작해서 트랜잭션을 커밋할 때 자동으로 수정된다. 따라서, 별도의 수정 메서드를 호출할 필요가 없다.</p>

</blockquote>

<h2 id="정리">정리</h2>

<p><strong>엔티티를 변경할 때는 항상 변경 감지를 사용하자.</strong></p>

<ol>
  <li>
    <p>컨트롤러에서 어설프게 엔티티를 생성하지 말자.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/* ItemController */</span>
 <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/items/{itemId}/edit"</span><span class="o">)</span>
 <span class="kd">public</span> <span class="nc">String</span> <span class="nf">updateItem</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">itemId</span><span class="o">,</span> <span class="nd">@ModelAttribute</span><span class="o">(</span><span class="s">"form"</span><span class="o">)</span> <span class="nc">BookForm</span> <span class="n">form</span><span class="o">){</span>
     <span class="c1">// 엔티티 생성하는 코드</span>
     <span class="cm">/*Book book = new Book();
     book.setId(form.getId());
     book.setName(form.getName());
     book.setPrice(form.getPrice());
     book.setStockQuantity(form.getStockQuantity());*/</span>
     <span class="n">itemService</span><span class="o">.</span><span class="na">updateItem</span><span class="o">(</span><span class="n">itemId</span><span class="o">,</span> <span class="n">form</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">form</span><span class="o">.</span><span class="na">getPrice</span><span class="o">(),</span> <span class="n">form</span><span class="o">.</span><span class="na">getStockQuantity</span><span class="o">());</span>
     <span class="k">return</span> <span class="s">"redirect:/items"</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/* ItemService */</span>
 <span class="nd">@Transactional</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateItem</span><span class="o">(</span><span class="nc">Long</span> <span class="n">itemId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">price</span><span class="o">,</span> <span class="kt">int</span> <span class="n">stockQuantity</span><span class="o">)</span> <span class="o">{</span>
     <span class="nc">Item</span> <span class="n">findItem</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">itemId</span><span class="o">);</span>
     <span class="c1">// setter() 사용 피하자.</span>
     <span class="cm">/*findItem.setName(name);
     findItem.setPrice(price);
     findItem.setStockQuantity(stockQuantity);*/</span>
     <span class="n">findItem</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">itemId</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">price</span><span class="o">,</span> <span class="n">stockQuantity</span><span class="o">);</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <p>파라미터로 전달할 데이터가 많다면 DTO를 사용하는 것도 하나의 방법이다.</p>

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/* ItemService */</span>
 <span class="nd">@Transactional</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateItem</span><span class="o">(</span><span class="nc">Long</span> <span class="n">itemId</span><span class="o">,</span> <span class="nc">UpdateItemDto</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
     <span class="nc">Item</span> <span class="n">findItem</span> <span class="o">=</span> <span class="n">itemRepository</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">itemId</span><span class="o">);</span>
     <span class="o">...</span>
 <span class="o">}</span>
</code></pre></div>    </div>

    <p>참고로 setter()를 열어서 사용하는 것보다 변경과 관련된 메서드를 만들어서 사용하는 것이 좋다.</p>
  </li>
  <li>트랜잭션이 있는 서비스 계층에 식별자( id )와 변경할 데이터를 명확하게 전달 (파라미터 or dto)</li>
  <li>트랜잭션이 있는 서비스 계층에서 영속 상태의 엔티티를 조회하고, 엔티티의 데이터를 직접 변경</li>
  <li>트랜잭션 커밋 시점에 변경 감지가 실행됨</li>
</ol>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#jpa" class="page__taxonomy-item" rel="tag">Jpa</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#jpa" class="page__taxonomy-item" rel="tag">Jpa</a>
    
    </span>
  </p>



        <!--

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 작성일</strong> <time datetime="2023-01-26T00:00:00+09:00">January 26, 2023</time></p>

작성일-->
      </footer>

      

      <!-- 기존 코드

  <nav class="pagination">
    
      <a href="/testcode/Mock/" class="pagination--pager" title="Mock 이란?
">이전</a>
    
    
      <a href="/jpa/Cascade/" class="pagination--pager" title="영속성 전이(Cascade), 고아 객체
">다음</a>
    
  </nav>

-->


<!--같은 카테고리내에서 다음으로 이동하는 것.-->



  

  

  

  

  

  

  
  	
  	
  	
  	
  	


  <nav class="pagination_prev_next" style="padding-top: 5px; padding-bottom: 5px;">
    
      <a href="/jpa/JPAMapping/" class="pagination_prev_next--pager"><span class="prev_next">이전 글  &nbsp</span>연관 관계 매핑</a>
    
    
      <a href="/jpa/Cascade/" class="pagination_prev_next--pager"><span class="prev_next">다음 글  &nbsp  </span>영속성 전이(Cascade), 고아 객체</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
          <li><a href="https://github.com/yessm621" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 승미 <a href="https://jekyllrb.com" rel="nofollow"></a>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
