<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.23.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="ko" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>준영속 - yessm621.dev</title>
<meta name="description" content="준영속 상태란">


  <meta name="author" content="승미">
  
  <meta property="article:author" content="승미">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="yessm621.dev">
<meta property="og:title" content="준영속">
<meta property="og:url" content="http://localhost:4000/jpa/DetachedEndity/">


  <meta property="og:description" content="준영속 상태란">







  <meta property="article:published_time" content="2023-03-13T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/jpa/DetachedEndity/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "승미",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="yessm621.dev Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- 사이트 맨위에 책 모양으로  파비콘 등록-->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/icon/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->
    <!--폰트 : "Nanum Gothic Coding", "Coming Soon"-->
    <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Coming+Soon&family=Nanum+Gothic+Coding&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Coming+Soon&family=Nanum+Gothic+Coding&display=swap">
     
    <!--폰트 : "Iropke Batang"-->
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/font-iropke-batang/1.2/font-iropke-batang.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/font-iropke-batang/1.2/font-iropke-batang.css">
  </head>

  <body class="layout--single <!-- 본문 늘리기!!!-->">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/setting/logo.png" alt="yessm621.dev"></a>
        
        <a class="site-title" href="/">
          yessm621.dev
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Category</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tag</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">메뉴</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/setting/bio-photo.png" alt="승미" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">승미</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>공부하며 기록하는 블로그입니다.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">팔로우</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">South Korea</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/yessm621" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="mailto:yessm621@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  

  <!--전체 글 수를 세기 위한 연산. sum 변수에 전체 글 수 저장-->



<nav class="nav__list">
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">메뉴</label>
  <ul class="nav__items" id="category_tag_menu">
      
      <!--전체 글 수-->
      <li>
            📂 <span style="font-family:'Cafe24Oneprettynight';">전체 글 수</style> <span style="font-family:'Coming Soon';">55</style> <span style="font-family:'Cafe24Oneprettynight';">개</style> 
      </li>

      <li>
        <!--기본 양식
         <span class="nav__sub-title">옆에 들어갈 큰 제목</span>
            <ul> 
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        -->
    
        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">Java</span><!--큰 카테고리-->
            <!--ul 태그로 같은 카테고리들 모아둔 페이지들 나열-->

            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Java" class="">문법(8)</a></li>
                    
                
                    
                
                    
                
            </ul>

            <ul>
                
                    
                        <li><a href="/categories/SpringBoot" class="">SpringBoot(10)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>

            <ul>
                
                    
                
                    
                        <li><a href="/categories/Jpa" class="">JPA(23)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>

            <ul>
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/TestCode" class="">테스트코드(3)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
        <!--------------------------------------분류 끝-------------------------------------------->
        
        <!--------------------------------------분류 시작-------------------------------------------->
        <!-- <span class="nav__sub-title">Python</span>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>     -->
        <!--------------------------------------분류 끝-------------------------------------------->

        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">Series</span>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Series" class="">시리즈(2)</a></li>
                    
                
            </ul>    
        <!--------------------------------------분류 끝-------------------------------------------->

        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">Git</span>
            <ul>
                
                    
                
                    
                
                    
                        <li><a href="/categories/Git" class="">Git(1)</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>    
        <!--------------------------------------분류 끝-------------------------------------------->
        
        <!--------------------------------------분류 시작-------------------------------------------->
        <span class="nav__sub-title">CS</span>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Http" class="">Http(5)</a></li>
                    
                
                    
                
            </ul>

            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/categories/Auth" class="">인증/인가(3)</a></li>
                    
                
                    
                
                    
                
                    
                
            </ul>

        <!--------------------------------------분류 끝-------------------------------------------->


      </li>
 
  </ul>
</nav>

  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="준영속">
    <meta itemprop="description" content="준영속 상태란">
    <meta itemprop="datePublished" content="2023-03-13T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">준영속
</h1>
          

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 작성일</strong> <time datetime="2023-03-13T00:00:00+09:00">March 13, 2023</time></p>

<!--작성일-->
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On This Page</h4></header>
              <ul class="toc__menu"><li><a href="#준영속-상태란">준영속 상태란</a></li><li><a href="#준영속-상태로-만드는-방법">준영속 상태로 만드는 방법</a><ul><li><a href="#엔티티를-준영속-상태로-전환">엔티티를 준영속 상태로 전환</a></li><li><a href="#영속성-컨텍스트-초기화">영속성 컨텍스트 초기화</a></li><li><a href="#영속성-컨텍스트-종료">영속성 컨텍스트 종료</a></li></ul></li><li><a href="#준영속-상태의-특징">준영속 상태의 특징</a></li></ul>

            </nav>
          </aside>
        
        <h2 id="준영속-상태란">준영속 상태란</h2>

<p>영속 상태의 엔티티가 영속성 컨텍스트에서 <code class="language-plaintext highlighter-rouge">분리(detached)</code>된 것을 말한다. <strong>준영속 상태의 엔티티는 영속성 컨텍스트에서 분리되었기 때문에 영속성 컨텍스트가 제공하는 기능을 사용하지 못한다.</strong> (Dirty Checking 등)</p>

<blockquote>
  <p><strong>참고</strong> 영속 상태가 되는 경우</p>
  <ol>
    <li>em.persist() 할 경우</li>
    <li>em.find()를 했는데 1차 캐시에 데이터가 없어 DB에서 조회했을 때</li>
  </ol>

</blockquote>

<h2 id="준영속-상태로-만드는-방법">준영속 상태로 만드는 방법</h2>

<ul>
  <li>em.detach(entity): 특정 엔티티만 준영속 상태로 전환한다.</li>
  <li>em.clear(): 영속성 컨텍스트를 완전히 초기화한다.</li>
  <li>em.close(): 영속성 컨텍스트를 종료한다.</li>
</ul>

<h3 id="엔티티를-준영속-상태로-전환">엔티티를 준영속 상태로 전환</h3>

<p>특정 엔티티만 준영속 상태로 전환한다. em.detach(entity)를 하는 순간 영속성 컨텍스트에게 더는 해당 엔티티를 관리하지 말라는 의미이다. 이 메소드를 호출하면 1차 캐시부터 쓰기 지연 SQL 저장소까지 해당 엔티티를 관리하기 위한 모든 정보가 제거된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 영속 상태</span>
<span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">200L</span><span class="o">);</span>
<span class="n">member</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"AAAA"</span><span class="o">);</span>

<span class="c1">// 준영속 상태로 변경</span>
<span class="n">em</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="영속성-컨텍스트-초기화">영속성 컨텍스트 초기화</h3>

<p>em.detach()는 특정 엔티티 하나를 준영속 상태로 만들고, <code class="language-plaintext highlighter-rouge">em.clear()</code>는 영속성 컨텍스트를 초기화해서 해당 영속성 컨텍스트의 <strong>모든 엔티티를 준영속 상태</strong>로 만든다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 영속 상태</span>
<span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">200L</span><span class="o">);</span>

<span class="c1">// 영속성 컨텍스트 초기화, 1차 캐시도 초기화 됨</span>
<span class="n">em</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="c1">// 1차 캐시에 없으니 다시 select문 실행</span>
<span class="nc">Member</span> <span class="n">member2</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">200L</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="영속성-컨텍스트-종료">영속성 컨텍스트 종료</h3>

<p>em.close()를 통해 영속성 컨텍스트를 종료하면 해당 영속성 컨텍스트가 관리하던 영속 상태의 엔티티가 모두 준영속 상태가 된다.</p>

<blockquote>
  <p><strong>참고</strong> 영속성 컨텍스트 초기화 vs 영속성 컨텍스트 종료
영속성 컨텍스트 초기화와 종료의 차이점은 초기화는 1차 캐시, 쓰기 지연 SQL은 남아있고 데이터만 지워지는 것이고 종료는 아예 1차 캐시, 쓰기 지연 SQL까지 없어지는 것이다.</p>

</blockquote>

<h2 id="준영속-상태의-특징">준영속 상태의 특징</h2>

<ul>
  <li>비영속 상태에 가깝다.
    <ul>
      <li>영속성 컨텍스트에서 관리하지 않으므로 영속성 컨텍스트가 제공하는 어떠한 기능도 사용할 수 없다.</li>
    </ul>
  </li>
  <li>식별자 값을 가지고 있다.
    <ul>
      <li>준영속 상태는 이미 한 번 영속 상태였으므로 식별자 값을 가지고 있다.</li>
    </ul>
  </li>
  <li>지연 로딩을 할 수 없다.
    <ul>
      <li>지연 로딩은 객체를 상속받아 프록시 객체로 로딩해두고 해당 객체를 실제 사용할 때 영속성 컨텍스트를 통해 데이터를 불러오는 방법이다.</li>
      <li>하지만, 준영속 상태에서는 영속성 컨텍스트가 관리하지 않으므로 지연 로딩 시  문제가 발생한다.</li>
    </ul>
  </li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#jpa" class="page__taxonomy-item" rel="tag">Jpa</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#jpa" class="page__taxonomy-item" rel="tag">Jpa</a>
    
    </span>
  </p>



        <!--

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 작성일</strong> <time datetime="2023-03-13T00:00:00+09:00">March 13, 2023</time></p>

작성일-->
      </footer>

      

      <!-- 기존 코드

  <nav class="pagination">
    
      <a href="/testcode/TestCodeSettings/" class="pagination--pager" title="테스트 환경 분리, @Transactional과 임베디드 DB
">이전</a>
    
    
      <a href="/jpa/JPA-CQS-CQRS-Pattern/" class="pagination--pager" title="CQS 패턴, CQRS 패턴
">다음</a>
    
  </nav>

-->


<!--같은 카테고리내에서 다음으로 이동하는 것.-->



  

  

  

  

  
  	
  	
  	
  	
  	


  <nav class="pagination_prev_next" style="padding-top: 5px; padding-bottom: 5px;">
    
      <a href="/jpa/Cascade/" class="pagination_prev_next--pager"><span class="prev_next">이전 글  &nbsp</span>영속성 전이(Cascade), 고아 객체</a>
    
    
      <a href="/jpa/JPA-CQS-CQRS-Pattern/" class="pagination_prev_next--pager"><span class="prev_next">다음 글  &nbsp  </span>CQS 패턴, CQRS 패턴</a>
    
  </nav>


    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>팔로우:</strong></li>
    

    
      
        
          <li><a href="https://github.com/yessm621" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 승미 <a href="https://jekyllrb.com" rel="nofollow"></a>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
