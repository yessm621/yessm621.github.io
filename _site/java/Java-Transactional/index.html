<p><br /></p>

<h2 id="트랜잭션이란">트랜잭션이란?</h2>

<hr />

<ul>
  <li>데이터베이스의 상태를 변경하는 작업</li>
  <li>한번에 수행되어야 하는 연산들을 의미</li>
  <li>begin, commit 을 자동으로 수행</li>
  <li>예외 발생 시  rollback 처리를 자동으로 수행</li>
</ul>

<p><br /></p>

<h2 id="트랜잭션의-4가지-성질">트랜잭션의 4가지 성질</h2>

<hr />

<ul>
  <li>
    <p>원자성</p>

    <p>→ 한 트랜잭션 내에서 실행한 작업들은 하나의 단위로 처리함. 즉, 모두 성공 또는 모두 실패</p>
  </li>
  <li>
    <p>일관성</p>

    <p>→ 일관성 있는 데이터베이스 상태를 유지</p>
  </li>
  <li>
    <p>격리성</p>

    <p>→ 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않도록 격리</p>
  </li>
  <li>
    <p>영속성</p>

    <p>→ 트랜잭션을 성공적으로 마치면 결과가 항상 저장되어야 함</p>
  </li>
</ul>

<p><br /></p>

<h2 id="트랜잭션-처리-방법">트랜잭션 처리 방법</h2>

<hr />

<p>스프링에서는 어노테이션 방식으로 사용</p>

<p>@Transactional 을 메소드, 클래스, 인터페이스 위에 추가하여 사용 (선언적 트랜잭션)</p>

<p>적용된 범위에서는 트랜잭션 기능이 포함된 프록시 객체가 생성되어 자동으로 commit 혹은 rollback 을 진행 해준다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="transactional-옵션">@Transactional 옵션</h2>

<hr />

<h3 id="1-isolation">1. isolation</h3>

<h3 id="2-propagation">2. propagation</h3>

<h3 id="3-norollbackfor-예외무시">3. noRollbackFor (예외무시)</h3>

<p>특정 예외 발생 시 Rollback 처리 하지 않음.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">noRollbackFor</span><span class="o">=</span><span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="4-rollbackfor-예외추가">4. rollbackFor (예외추가)</h3>

<p>특정 예외 발생 시 강제로 Rollback</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">rollbackFor</span><span class="o">=</span><span class="nc">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="5-timeout-시간지정">5. timeout (시간지정)</h3>

<p>지정한 시간 내에 해당 메소드 수행이 완료되지 않을 경우 rollback 수행 (default=-1)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div></div>

<h3 id="6-readonly-읽기전용">6. readOnly (읽기전용)</h3>

<p>true 시 insert, update, delete 실행 시 예외 발생 (default=false)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span> <span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="transactional-만-붙이면-롤백이-안되는-이유">@Transactional 만 붙이면 롤백이 안되는 이유?</h2>

<hr />

<p>@Transactional 은 기본적으로 unchecked Exception, Error 만을 롤백한다</p>

<p>따라서, 모든 예외에 대해 롤백을 진행하고 싶을 경우 @Transactional(rollbackFor = Exception.class) 를 써야한다.</p>

<p><br />
<br /></p>
