I"’p<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°</p>

<p>â†’ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µ</p>

<ul>
  <li>ì„¸ì…˜(HttpSession) ê¸°ë°˜: ì‚¬ìš©ì ì •ë³´ëŠ” ì„œë²„ì—ì„œ ë³´ê´€, í•„ìš”ì‹œ ì„¤ì •ì„ í†µí•´ì„œ ì œì–´</li>
  <li></li>
</ul>

<p><br /></p>

<h1 id="1-ìŠ¤í”„ë§-ì‹œíë¦¬í‹°ë¥¼-ì´ìš©í•˜ëŠ”-í”„ë¡œì íŠ¸">1. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•˜ëŠ” í”„ë¡œì íŠ¸</h1>

<p>build.gradle</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">implementation</span> <span class="s">'org.thymeleaf.extras:thymeleaf-extras-springsecurity5'</span>
</code></pre></div></div>

<p>application.yml</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
    <span class="na">com</span><span class="pi">:</span>
      <span class="na">springframework</span><span class="pi">:</span>
        <span class="na">security</span><span class="pi">:</span>
          <span class="na">web</span><span class="pi">:</span>
            <span class="s">trace</span>
      <span class="na">project</span><span class="pi">:</span>
        <span class="s">debug</span>
</code></pre></div></div>

<p>security ê´€ë ¨ ë¶€ë¶„ì€ ë¡œê·¸ ë ˆë²¨ì„ ë‚®ê²Œ ì„¤ì •í•´ì„œ ìì„¸í•œ ë¡œê·¸ í™•ì¸</p>

<p>ìœ„ì˜ ì„¤ì •ì„ ì™„ë£Œí•˜ë©´ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰ ì‹œ ë‹¤ìŒê³¼ ê°™ì´ ì¤‘ê°„ì— íŒ¨ìŠ¤ì›Œë“œ í•˜ë‚˜ê°€ ì¶œë ¥ë¨</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/09f9598f-f967-4fba-8a07-6b473a2c9083/Untitled.png" alt="Untitled" /></p>

<p>ìƒì„±ëœ íŒ¨ìŠ¤ì›Œë“œëŠ” user ê³„ì •ì˜ íŒ¨ìŠ¤ì›Œë“œ (ì„ì‹œ íŒ¨ìŠ¤ì›Œë“œ ì—­í™œì„ í•¨)</p>

<p><a href="http://localhost:8080/login">localhost:8080/login</a> ì˜ ê²½ë¡œë¡œ ì ‘ê·¼ í–ˆì„ ë•Œ ì•„ë˜ì™€ ê°™ì€ í™”ë©´ì´ ë³´ì¸ë‹¤.</p>

<p><img src="https://s3-us-west-2.amazonaws.com/secure.notion-static.com/58b65bd0-08b2-4ad1-b44c-c09eaf5a7229/Untitled.png" alt="Untitled" /></p>

<p><br /></p>

<p>ì°¸ê³ ) ë¸Œë¼ìš°ì €ì—ì„œ ê°•ì œë¡œ ë¡œê·¸ì•„ì›ƒí•˜ê³  ì‹¶ì„ ë•, ê°œë°œì ë„êµ¬ì˜ Applicationíƒ­ì—ì„œ Cookies ì˜ <code class="language-plaintext highlighter-rouge">JSESSIONID</code> ë¥¼ ê°•ì œ ì‚­ì œí•œë‹¤</p>

<p>ì¿ í‚¤ë“¤ ì¤‘ì— í†°ìº£ì€ JSESSIONID ë¼ëŠ” ì´ë¦„ì˜ ì¿ í‚¤ë¥¼ ì‚¬ìš©</p>

<p><br /></p>

<h2 id="11-ì‹œíë¦¬í‹°-ì„¤ì •-í´ë˜ìŠ¤-ì‘ì„±">1.1 ì‹œíë¦¬í‹° ì„¤ì • í´ë˜ìŠ¤ ì‘ì„±</h2>

<p>SecurityConfig í´ë˜ìŠ¤ ì¶”ê°€</p>

<p>í•´ë‹¹ í´ë˜ìŠ¤ì—ëŠ” ì‹œíë¦¬í‹° ê´€ë ¨ ê¸°ëŠ¥ì„ ì‰½ê²Œ ì„¤ì •í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">WebSecurityConfigurerAdapter</code> ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ìƒì†ìœ¼ë¡œ ì²˜ë¦¬. WebSecurityConfigurerAdapter í´ë˜ìŠ¤ëŠ” ì£¼ë¡œ override ë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ì„¤ì • ì¡°ì •</p>

<p>config/SecurityConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<h2 id="12-í™•ì¸ì„-ìœ„í•œ-samplecontroller">1.2 í™•ì¸ì„ ìœ„í•œ SampleController</h2>

<p>SampleController.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@Log4j2</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/sample"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SampleController</span> <span class="o">{</span>

    <span class="c1">// ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/all"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exAll</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"all.............."</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/member"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exMember</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"member.............."</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// ê´€ë¦¬ì ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œì´ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ”</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/admin"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">exAdmin</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"admin.............."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>templates ë„ ì‘ì„±</p>

<p><br /></p>

<h2 id="13-ìŠ¤í”„ë§-ì‹œíë¦¬í‹°-ìš©ì–´ì™€-íë¦„">1.3 ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ìš©ì–´ì™€ íë¦„</h2>

<p>Filter1,2,3â€¦N â†’ Authentication Manager â†’ AuthenticationProvider â†’ UserDetailsService</p>

<p>Authentication Manager(ì¸ì¦ ë§¤ë‹ˆì €): í•µì‹¬ ì—­í• </p>

<p>AuthenticationProvider: ì¸ì¦ ë§¤ë‹ˆì €ê°€ ì–´ë–»ê²Œ ë™ì‘í•´ì•¼ í•˜ëŠ”ì§€ë¥¼ ê²°ì •</p>

<p>UserDetailsService: ì‹¤ì œ ì¸ì¦</p>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ í•µì‹¬ ê°œë…ì€ <code class="language-plaintext highlighter-rouge">ì¸ì¦(Authentication)</code>ê³¼ <code class="language-plaintext highlighter-rouge">ì¸ê°€(Authorization)</code></p>

<p>ì˜ˆì‹œ) ì€í–‰ì— ê¸ˆê³ ê°€ í•˜ë‚˜ ìˆê³ , ì‚¬ìš©ìê°€ ê¸ˆê³ ì˜ ë‚´ìš©ì„ ì—´ì–´ë³¸ë‹¤ ê°€ì •í•˜ì˜€ì„ ë•Œ</p>

<ol>
  <li>ì‚¬ìš©ìëŠ” ì€í–‰ì— ê°€ì„œ ìì‹ ì´ ì–´ë–¤ ì‚¬ëŒì¸ì§€ ìì‹ ì˜ ì‹ ë¶„ì¦ìœ¼ë¡œ ìì‹ ì„ ì¦ëª…</li>
  <li>ì€í–‰ì—ì„œëŠ” ì‚¬ìš©ìì˜ ì‹ ë¶„ì„ í™•ì¸</li>
  <li>ì€í–‰ì—ì„œ ì‚¬ìš©ìê°€ ê¸ˆê³ ë¥¼ ì—´ì–´ ë³¼ ìˆ˜ ìˆëŠ” ì‚¬ëŒì¸ì§€ë¥¼ íŒë‹¨</li>
  <li>ë§Œì¼ ì ì ˆí•œ ê¶Œë¦¬ë‚˜ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìì˜ ê²½ìš° ê¸ˆê³ ë¥¼ ì—´ì–´ì¤Œ</li>
</ol>

<p>1ì€ ì¸ì¦(ìì‹ ì„ ì¦ëª…), 3ì€ ì¸ê°€(ì‚¬ìš©ìì—ê²Œ ì¼ì¢…ì˜ í—ˆê°€ë¥¼ í•´ ì£¼ëŠ” ê³¼ì •)</p>

<p><br /></p>

<h3 id="í•„í„°ì™€-í•„í„°-ì²´ì´ë‹">í•„í„°ì™€ í•„í„° ì²´ì´ë‹</h3>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œ í•„í„°ëŠ” ìŠ¤í”„ë§ì˜ ë¹ˆê³¼ ì—°ë™í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ ì„¤ê³„ë¨</p>

<p>ì—¬ëŸ¬ ê°œì˜ í•„í„°ê°€ Filter Chain ì´ë¼ëŠ” êµ¬ì¡°ë¡œ Request ë¥¼ ì²˜ë¦¬í•˜ê²Œ ë¨. ê°œë°œ ì‹œì— í•„í„°ë¥¼ í™•ì¥í•˜ê³  ì„¤ì •í•˜ë©´ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•´ì„œ ë‹¤ì–‘í•œ í˜•íƒœì˜ ë¡œê·¸ì¸ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ê²Œ ë¨</p>

<p><br /></p>

<h3 id="ì¸ì¦ì„-ìœ„í•œ-authenticationmanageram">ì¸ì¦ì„ ìœ„í•œ AuthenticationManager(AM)</h3>

<p>í•„í„°ì˜ í•µì‹¬ì ì¸ ë™ì‘ì€ AuthenticationManagerì„ í†µí•´ì„œ ì¸ì¦ì´ë¼ëŠ” íƒ€ì…ì˜ ê°ì²´ë¡œ ì‘ì—…</p>

<p>AuthenticationManagerê°€ ê°€ì§„ ì¸ì¦ ì²˜ë¦¬ ë©”ì„œë“œëŠ” íŒŒë¼ë¯¸í„°,ë¦¬í„´ íƒ€ì… ëª¨ë‘ Authentication.</p>

<p>ì¸ì¦: ìŠ¤ìŠ¤ë¡œ ì¦ëª…í•˜ë‹¤ (= ì£¼ë¯¼ë“±ë¡ì¦)</p>

<p>ì˜ˆì‹œ) ë¡œê·¸ì¸ í•˜ëŠ” ê³¼ì •ì—ì„œëŠ” ì‚¬ìš©ìì˜ ì•„ì´ë””/íŒ¨ìŠ¤ì›Œë“œë¡œ ìì‹ ì´ ì–´ë–¤ ì‚¬ëŒì¸ì§€ ì „ë‹¬. ê²€ì¦í•˜ëŠ” í–‰ìœ„ëŠ” AuthenticationManagerë¥¼ í†µí•´ ì´ë£¨ì–´ì§</p>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹° í•„í„°ì˜ ì£¼ìš” ì—­í• ì€ ì¸ì¦ ê´€ë ¨ëœ ì •ë³´ë¥¼ í† í°ì´ë¼ëŠ” ê°ì²´ë¡œ ë§Œë“¤ì–´ì„œ ì „ë‹¬. UsernamePasswordAuthenticationToken ì˜ ë™ì‘</p>

<ol>
  <li>request ë¥¼ ì´ìš©í•´ ì‚¬ìš©ìì˜ ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œ ë°›ìŒ</li>
  <li>ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œë¡œ UsernamePasswordAuthenticationToken ë¼ëŠ” ê°ì²´ ìƒì„±</li>
  <li>ê°ì²´ë¥¼ AuthenticationManager ì˜ authenticate() ì— ì „ë‹¬</li>
</ol>

<p>AuthenticationManager ëŠ” ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì²˜ë¦¬ ë°©ë²•ì„ ì œê³µ</p>

<ul>
  <li>ë°ì´í„°ë² ì´ìŠ¤ ì´ìš©</li>
  <li>ë©”ëª¨ë¦¬ìƒì— ìˆëŠ” ì •ë³´ë¥¼ í™œìš©</li>
</ul>

<p>AuthenticationProvider ëŠ” ì „ë‹¬ë˜ëŠ” í† í°ì˜ íƒ€ì…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì¡´ì¬ì¸ì§€ë¥¼ í™•ì¸í•˜ê³  authenticate() ë¥¼ ìˆ˜í–‰</p>

<p>AuthenticationProvider ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ UserDetailsService ë¥¼ ì´ìš©. UserDetailsServiceëŠ” ì‹¤ì œë¡œ ì¸ì¦ì„ ìœ„í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì—­í• </p>

<p><br /></p>

<h3 id="ì¸ê°€ì™€-ê¶Œí•œì ‘ê·¼-ì œí•œ">ì¸ê°€ì™€ ê¶Œí•œ/ì ‘ê·¼ ì œí•œ</h3>

<p>ì¸ì¦ì²˜ë¦¬ ë‹¨ê³„ê°€ ëë‚˜ë©´ ì‚¬ìš©ìì˜ ê¶Œí•œì´ ì ì ˆí•œì§€ í™•ì¸</p>

<p>ì¸ì¦: ì‚¬ìš©ìê°€ ìŠ¤ìŠ¤ë¡œ ìì‹ ì„ ì¦ëª…í•˜ëŠ” ê²ƒ</p>

<p>ì¸ê°€: í—ˆê°€ì˜ ì˜ë¯¸</p>

<p>AuthenticationManager ì˜ authenticate() ë©”ì„œë“œì˜ ë¦¬í„´ê°’ì€ Authentication(ì¸ì¦)</p>

<p>ì´ ì¸ì¦ ì •ë³´ì—ëŠ” Roles ë¼ëŠ” ê¶Œí•œì— ëŒ€í•œ ì •ë³´ê°€ ìˆìŒ. ì´ ì •ë³´ë¡œ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì‘ì—…ì„ í•  ìˆ˜ ìˆëŠ”ì§€ í—ˆê°€í•˜ê²Œ ë˜ëŠ”ë° ì´ëŸ¬í•œ í–‰ìœ„ë¥¼ Access-Control(ì ‘ê·¼ ì œí•œ)ì´ë¼ê³  í•¨</p>

<p>ë‹¨ê³„1. ì‚¬ìš©ìëŠ” ì›í•˜ëŠ” URL ì„ ì…ë ¥</p>

<p>ë‹¨ê³„2. ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì—ì„œëŠ” ì¸ì¦/ì¸ê°€ê°€ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í•˜ê³ (í•„í„°ì—ì„œ íŒë‹¨) ì‚¬ìš©ìê°€ ì¸ì¦í•˜ë„ë¡ ë¡œê·¸ì¸ í™”ë©´ ë³´ì—¬ì¤Œ</p>

<ol>
  <li>ì˜¬ë°”ë¥¸ ì‚¬ìš©ìë¼ê³  ì¸ì¦ë˜ë©´ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ Authentication íƒ€ì…ìœ¼ë¡œ ì „ë‹¬(ì¸ì¦)</li>
  <li>ì „ë‹¬ëœ ê°ì²´ë¡œ ì‚¬ìš©ìê°€ ì ì ˆí•œ ê¶Œí•œì´ ìˆëŠ”ì§€ í™•ì¸(ì¸ê°€)</li>
</ol>

<p>ë‹¨ê³„3. ì •ë³´ê°€ ì „ë‹¬ëœë‹¤ë©´ AuthenticationManagerê°€ ì ì ˆí•œ AuthenticationProviderë¥¼ ì°¾ì•„ì„œ ì¸ì¦ì„ ì‹œë„</p>

<p><br /></p>

<h1 id="2-ìŠ¤í”„ë§-ì‹œíë¦¬í‹°-ì»¤ìŠ¤í„°ë§ˆì´ì§•">2. ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ì»¤ìŠ¤í„°ë§ˆì´ì§•</h1>

<p><br /></p>

<h2 id="21-ë°˜ë“œì‹œ-í•„ìš”í•œ-passwordencoder">2.1 ë°˜ë“œì‹œ í•„ìš”í•œ PasswordEncoder</h2>

<p>íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”</p>

<p>BCryptPasswordEncoder ëŠ” bcrypt ë¼ëŠ” í•´ì‹œ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì•”í˜¸í™”í•˜ëŠ” ëª©ì ìœ¼ë¡œ ì„¤ê³„ëœ í´ë˜ìŠ¤. BCryptPasswordEncoder ë¡œ ì•”í˜¸í™”ëœ íŒ¨ìŠ¤ì›Œë“œëŠ” ë³µí˜¸í™”ê°€ ë¶ˆê°€ëŠ¥í•˜ê³  ë§¤ë²ˆ ì•”í˜¸í™”ëœ ê°’ë„ ë‹¤ë¦„.</p>

<p>SecurityConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BCryptPasswordEncoder</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<h2 id="22-authenticationmanager-ì„¤ì •">2.2 AuthenticationManager ì„¤ì •</h2>

<p>SecurityConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BCryptPasswordEncoder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="c1">// ì‚¬ìš©ì ê³„ì •ì€ user1</span>
        <span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">().</span><span class="na">withUser</span><span class="o">(</span><span class="s">"user1"</span><span class="o">)</span>
                <span class="c1">// 1111 íŒ¨ìŠ¤ì›Œë“œ ì¸ì½”ë”© ê²°ê³¼</span>
                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"$2a$10$yfgSY/2154i6Tf9/s83PCeCB/xo1L1/7dtGv1XG2mN4l3Qwlz05Ze"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p><br /></p>

<h2 id="23-ì¸ê°€ê°€-í•„ìš”í•œ-ë¦¬ì†ŒìŠ¤-ì„¤ì •">2.3 ì¸ê°€ê°€ í•„ìš”í•œ ë¦¬ì†ŒìŠ¤ ì„¤ì •</h2>

<p>SecurityConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/all"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/member"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>

        <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div></div>

<p><strong>http.authorizeRequests()</strong></p>

<p>ì¸ì¦ì´ í•„ìš”í•œ ìì›ë“¤ì„ ì„¤ì •</p>

<p><strong>antMatchers(â€œ</strong>/*â€)**</p>

<p>ì•¤íŠ¸ ìŠ¤íƒ€ì¼ì˜ íŒ¨í„´ìœ¼ë¡œ ì›í•˜ëŠ” ìì›ì„ ì„ íƒ</p>

<p><strong>permitAll()</strong></p>

<p>ëª¨ë“  ì‚¬ìš©ìì—ê²Œ í—ˆë½</p>

<p><strong>http.formLogin();</strong></p>

<p>ì¸ê°€/ì¸ì¦ì— ì‹¤íŒ¨ì‹œ ë¡œê·¸ì¸ í™”ë©´</p>

<p><br /></p>

<h2 id="24-csrf-ì„¤ì •">2.4 CSRF ì„¤ì •</h2>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ëŠ” CSRF ë¼ëŠ” ê³µê²©ì„ ë°©ì–´í•˜ê¸° ìœ„í•´ ì„ì˜ì˜ ê°’ì„ ë§Œë“¤ì–´ ì´ë¥¼ GET ë°©ì‹ì„ ì œì™¸í•œ ëª¨ë“  ìš”ì²­ ë°©ì‹(POST,PUT,DELETE)ì— í¬í•¨ì‹œì¼œì•¼ë§Œ ì •ìƒì ì¸ ë™ì‘ì„ í•¨</p>

<p>CSRF(Cross Site Request Forgery)ê³µê²©: ì‚¬ì´íŠ¸ê°„ ìš”ì²­ ìœ„ì¡°</p>

<p>form íƒœê·¸ë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹ì—ì„œ CSRF í† í°ì´ ë³´ì•ˆìƒìœ¼ë¡œ ê¶Œì¥ë¨. RESTë°©ì‹ì—ì„œëŠ” ë§¤ë²ˆ CSRF í† í°ì˜ ê°’ì„ ì•Œì•„ë‚´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ìˆê¸° ë•Œë¬¸ì— ê²½ìš°ì— ë”°ë¼ CSRF í† í°ì˜ ë°œí–‰ì„ í•˜ì§€ ì•ŠëŠ” ê²½ìš°ë„ ìˆìŒ</p>

<p><br /></p>

<h3 id="csrfí† í°-ë¹„í™œì„±í™”">csrfí† í° ë¹„í™œì„±í™”</h3>

<p>SecurityConfig.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.log4j.Log4j2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="nd">@Log4j2</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/all"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/sample/member"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">);</span>

        <span class="n">http</span><span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
        <span class="n">http</span><span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span>
        <span class="n">http</span><span class="o">.</span><span class="na">logout</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>

</code></pre></div></div>

<p><strong>http.csrf().disable();</strong></p>

<p>ì˜ˆì œì—ì„œëŠ” RESTë°©ì‹ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ì„¤ì •ì„ ë‹¤ë£¨ê¸° ìœ„í•´ CSRF í† í°ì„ ë°©í–‰í•˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ ì„¤ì •</p>

<p><br /></p>

<h2 id="25-logout-ì„¤ì •">2.5 logout ì„¤ì •</h2>

<p><strong>http.logout();</strong></p>

<p>logout() ì—ì„œ ì£¼ì˜í•´ì•¼ í•  ì ì€ CSRF í† í°ì„ ì‚¬ìš©í•  ë•Œ POST ë°©ì‹ìœ¼ë¡œë§Œ ë¡œê·¸ì•„ì›ƒ</p>

<p>CSRF í† í°ì„ disable() ë¡œ ë¹„í™œì„±í™” ì‹œí‚¤ë©´ GET ë°©ì‹ìœ¼ë¡œë„ ë¡œê·¸ì•„ì›ƒ í•  ìˆ˜ ìˆìŒ</p>

<p><br /><br /></p>

<h1 id="3-í”„ë¡œì íŠ¸ë¥¼-ìœ„í•œ-jpa-ì²˜ë¦¬">3. í”„ë¡œì íŠ¸ë¥¼ ìœ„í•œ JPA ì²˜ë¦¬</h1>

<p>Member.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.*</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Builder</span>
<span class="nd">@Getter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="kd">extends</span> <span class="n">baseEntity</span> <span class="o">{</span>

		<span class="nd">@Id</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Boolean</span> <span class="n">fromSocial</span><span class="o">;</span>

    <span class="nd">@ElementCollection</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="nd">@Builder</span><span class="o">.</span><span class="na">Default</span>
    <span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">MemberRole</span><span class="o">&gt;</span> <span class="n">roleSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addMemberRole</span><span class="o">(</span><span class="nc">MemberRole</span> <span class="n">memberRole</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">roleSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">memberRole</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>MemberRole.java</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.project.netflix.entity</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">MemberRole</span> <span class="o">{</span>
    <span class="no">USER</span><span class="o">,</span> <span class="no">MANAGER</span><span class="o">,</span> <span class="no">ADMIN</span>
<span class="o">}</span>
</code></pre></div></div>
:ET